# 📕 메모리 북 (SillyTavern 확장 프로그램)

자동화되고 구조화되었으며 신뢰할 수 있는 메모리 생성을 위한 차세대 SillyTavern 확장 프로그램입니다. 채팅에서 장면을 표시하고, AI로 JSON 기반 요약을 생성하며, 로어북에 "[벡터화된](#vectorized)" 항목으로 저장하세요. 그룹 채팅, 고급 프로필 관리 및 완벽한 API/모델 처리를 지원합니다.

**📘 [사용자 가이드 (EN)](USER_GUIDE.md)** | **📋 [버전 히스토리 및 변경 로그](changelog.md)**

> 참고: 다양한 언어를 지원합니다: 목록은 [`/locales`](locales) 폴더를 참조하세요. 국제/현지화된 Readme 및 사용자 가이드는 [`/userguides`](userguides) 폴더에서 찾을 수 있습니다.
> 로어북 변환기 및 사이드 프롬프트 템플릿 라이브러리는 [`/resources`](resources) 폴더에 있습니다.

## 자주 묻는 질문
### 확장 프로그램 메뉴의 항목은 어디에 있나요?
설정은 확장 프로그램 메뉴(입력 상자 왼쪽의 마술봉 🪄)에 있습니다. "메모리 북"을 찾으세요.

![STMB 설정 위치](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/menu.png)

### 벡터화됨?

월드 정보의 🔗 항목은 ST의 UI에서 "vectorized"로 명명됩니다. 이것이 제가 월드 벡터화라는 단어를 사용하는 이유입니다. 벡터 확장 프로그램을 사용하지 않는 경우(저는 사용하지 않습니다), 키워드를 통해 작동합니다. 이것은 모두 자동화되어 있어 어떤 키워드를 사용할지 생각할 필요가 없습니다.

![ST의 전략 드롭다운](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/vectorized.png)

![AI를 통해 생성된 키워드](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/keywords.png)

---

## 🚦 새로운 기능 (v4.6.7)

### 🪲 다양한 버그 수정
- 자동 생성 및 자동 요약 수정

### 🌐 국제화
- 국제화 계속 진행 (목록은 [`/locales`](locales) 폴더를 확인하세요.)

---

## 📋 전제 조건

- **SillyTavern:** 1.13.4+ (최신 버전 권장)
- **장면 선택:** 시작 및 끝 마커(시작 < 끝)가 설정되어야 합니다.
- **채팅 완료 지원:** OpenAI, Claude, Anthropic, OpenRouter 또는 기타 채팅 완료 API를 완벽하게 지원합니다.
- **텍스트 완료 지원:** 텍스트 완료 API(Kobold, TextGen 등)는 SillyTavern의 전체 수동 구성 또는 사용자 지정 완료 소스를 통해 연결될 때 지원됩니다.

## 💡 권장 글로벌 월드 정보/로어북 활성화 설정

- **전체 단어 일치:** 선택 해제 (거짓)
- **스캔 깊이:** 높을수록 좋음 (최소 4)
- **최대 재귀 단계:** 2 (일반 권장 사항, 필수는 아님)
- **컨텍스트 %:** 40% (100,000 토큰의 컨텍스트 창 기준) - 매우 무거운 채팅 기록이나 봇이 없다고 가정

---

## 🚀 시작하기

### 1. **설치 및 로드**
- SillyTavern을 로드하고 캐릭터 또는 그룹 채팅을 선택합니다.
- 채팅 메시지에 쉐브론 버튼(► ◄)이 나타날 때까지 기다립니다 (최대 10초 소요될 수 있음).

![이 버튼들을 기다리세요](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/startup.png)

### 2. **장면 표시**
- 장면의 첫 번째 메시지에서 ►를 클릭합니다.
- 마지막 메시지에서 ◄를 클릭합니다.

![장면 선택을 보여주는 시각적 피드백](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/button-start.png)

### 3. **메모리 생성**
- 확장 프로그램 메뉴(마술봉 🪄)를 열고 "메모리 북"을 클릭하거나 `/creatememory` 슬래시 명령어를 사용합니다.
- 메시지가 표시되면 설정(프로필, 컨텍스트, API/모델)을 확인합니다.
- AI 생성 및 자동 로어북 항목을 기다립니다.

---

## 🆕 슬래시 명령어 단축키

- `/creatememory`는 기존 쉐브론 시작/끝 마커를 사용하여 메모리를 생성합니다
- `/scenememory x-y`는 메시지 x로 시작하여 메시지 y로 끝나는 메모리를 만듭니다
- `/nextmemory`는 마지막 메모리 이후의 모든 메시지로 메모리를 만듭니다.

## 👥 그룹 채팅 지원

- 모든 기능이 그룹 채팅에서 작동합니다.
- 장면 마커, 메모리 생성 및 로어북 통합은 그룹 메타데이터에 저장됩니다.
- 특별한 설정이 필요 없습니다—그냥 그룹 채팅을 선택하고 평소처럼 사용하세요.

---

## 🧭 작동 모드

### **자동 모드 (기본값)**
- **작동 방식:** 현재 채팅에 바인딩된 로어북을 자동으로 사용합니다.
- **최적:** 단순성과 속도. 대부분의 사용자는 여기서 시작해야 합니다.
- **사용 방법:** 캐릭터 또는 그룹 채팅의 "채팅 로어북" 드롭다운에서 로어북이 선택되었는지 확인하세요.

![채팅 로어북 바인딩 예시](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/chatlorebook.png)

### **로어북 자동 생성 모드** ⭐ *v4.2.0의 새로운 기능*
- **작동 방식:** 사용자 지정 이름 지정 템플릿을 사용하여 기존 로어북이 없을 때 새 로어북을 자동으로 생성하고 바인딩합니다.
- **최적:** 신규 사용자 및 빠른 설정. 원클릭 로어북 생성에 적합합니다.
- **사용 방법:**
  1. 확장 프로그램 설정에서 "로어북이 없으면 자동 생성"을 활성화합니다.
  2. 이름 지정 템플릿을 구성합니다 (기본값: "LTM - {{char}} - {{chat}}").
  3. 바인딩된 로어북 없이 메모리를 생성하면 자동으로 생성되고 바인딩됩니다.
- **템플릿 플레이스홀더:** {{char}} (캐릭터 이름), {{user}} (사용자 이름), {{chat}} (채팅 ID)
- **스마트 번호 매기기:** 중복된 이름이 있는 경우 자동으로 숫자(2, 3, 4...)를 추가합니다.
- **참고:** 수동 로어북 모드와 동시에 사용할 수 없습니다.

### **수동 로어북 모드**
- **작동 방식:** 주 채팅 바인딩 로어북을 무시하고 채팅별로 메모리를 위한 다른 로어북을 선택할 수 있습니다.
- **최적:** 메모리를 특정, 별도의 로어북으로 보내려는 고급 사용자.
- **사용 방법:**
  1. 확장 프로그램 설정에서 "수동 로어북 모드 활성화"를 활성화합니다.
  2. 채팅에서 처음으로 메모리를 생성할 때 로어북을 선택하라는 메시지가 표시됩니다.
  3. 이 선택은 지우거나 자동 모드로 다시 전환할 때까지 해당 채팅에 대해 저장됩니다.
- **참고:** 로어북 자동 생성 모드와 동시에 사용할 수 없습니다.

---

## 📝 메모리 생성

### **JSON 전용 출력**
모든 프롬프트와 사전 설정은 AI가 유효한 JSON만 반환하도록 지시해야 합니다. 예:

```json
{
  "title": "짧은 장면 제목",
  "content": "장면에 대한 상세한 요약...",
  "keywords": ["키워드1", "키워드2"]
}
```
**응답에 다른 텍스트는 허용되지 않습니다.**

### **내장 사전 설정**
1. **요약:** 상세한 단계별 요약.
2. **요약하기:** 타임라인, 비트, 상호 작용, 결과에 대한 마크다운 헤더.
3. **시놉시스:** 포괄적이고 구조화된 마크다운.
4. **요약:** 타임라인이 포함된 간결한 비트 요약.
5. **최소:** 1-2 문장 요약.

### **사용자 지정 프롬프트**
- 자신만의 프롬프트를 만들 수 있지만 위와 같이 유효한 JSON을 반환해야 합니다.

---

## 📚 로어북 통합

- **자동 항목 생성:** 새 메모리는 모든 메타데이터와 함께 항목으로 저장됩니다.
- **플래그 기반 감지:** `stmemorybooks` 플래그가 있는 항목만 메모리로 인식됩니다.
- **자동 번호 매기기:** 순차적이고 0으로 채워진 번호 매기기. 여러 형식을 지원합니다 (`[000]`, `(000)`, `{000}`, `#000`).
- **수동/자동 순서:** 프로필별 삽입 순서 설정.
- **편집기 새로고침:** 메모리를 추가한 후 선택적으로 로어북 편집기를 자동으로 새로고침합니다.

> **기존 메모리는 변환해야 합니다!**
> [로어북 변환기](/resources/lorebookconverter.html)를 사용하여 `stmemorybooks` 플래그와 필수 필드를 추가하세요.

---

### 🎡 사이드 프롬프트

사이드 프롬프트는 트래커처럼 사용할 수 있으며 메모리 로어북에 항목을 생성합니다.
- **액세스:** 메모리 북 설정에서 "🎡 사이드 프롬프트 관리자"를 클릭합니다.
- **기능:**
    - 모든 사이드 프롬프트를 봅니다.
    - 다른 프롬프트 스타일을 실험하기 위해 새 프롬프트를 만들거나 복제합니다.
    - 내장된 사전 설정을 포함하여 모든 사전 설정을 편집하거나 삭제합니다.
    - 백업 또는 공유를 위해 사전 설정을 JSON 파일로 내보내고 가져옵니다.
    - 수동으로 또는 메모리 생성과 함께 자동으로 실행합니다.
- **사용 팁:**
    - 새 프롬프트를 만들 때 최상의 호환성을 위해 내장된 프롬프트를 복사할 수 있습니다.
    - 추가 사이드 프롬프트 템플릿 라이브러리 [JSON 파일](resources/SidePromptTemplateLibrary.json) - 가져오기만 하면 사용할 수 있습니다.

---

### 🧠 고급 사용자 정의를 위한 Regex 통합
- **텍스트 처리의 완전한 제어**: 이제 메모리 북은 SillyTavern의 **Regex** 확장 프로그램과 통합되어 두 가지 주요 단계에서 강력한 텍스트 변환을 적용할 수 있습니다.
    1.  **프롬프트 생성**: **사용자 입력** 배치를 대상으로 하는 정규식 스크립트를 만들어 AI에 전송되는 프롬프트를 자동으로 수정합니다.
    2.  **응답 구문 분석**: **AI 출력** 배치를 대상으로 하여 AI의 원시 응답을 저장하기 전에 정리, 재구성 또는 표준화합니다.
- **작동 방식**: 통합은 원활합니다. Regex 확장 프로그램에서 원하는 스크립트를 만들고 활성화하기만 하면 메모리 북이 메모리 및 사이드 프롬프트 생성 중에 자동으로 적용합니다.

---

## 👤 프로필 관리

- **프로필:** 각 프로필에는 API, 모델, 온도, 프롬프트/사전 설정, 제목 형식 및 로어북 설정이 포함됩니다.
- **가져오기/내보내기:** 프로필을 JSON으로 공유합니다.
- **프로필 생성:** 고급 옵션 팝업을 사용하여 새 프로필을 저장합니다.
- **프로필별 재정의:** 메모리 생성을 위해 일시적으로 API/모델/온도를 전환한 다음 원래 설정으로 복원합니다.

---

## ⚙️ 설정 및 구성

![주 설정 패널](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/Main.png)

### **전역 설정**
- **수동 로어북 모드:** 채팅별로 로어북을 선택할 수 있도록 활성화합니다.
- **로어북이 없으면 자동 생성:** ⭐ *v4.2.0의 새로운 기능* - 이름 지정 템플릿을 사용하여 로어북을 자동으로 생성하고 바인딩합니다.
- **로어북 이름 템플릿:** ⭐ *v4.2.0의 새로운 기능* - {{char}}, {{user}}, {{chat}} 플레이스홀더로 자동 생성된 로어북 이름을 사용자 지정합니다.
- **장면 중첩 허용:** 중첩된 메모리 범위를 허용하거나 방지합니다.
- **항상 기본 프로필 사용:** 확인 팝업을 건너뜁니다.
- **메모리 미리보기 표시:** 로어북에 추가하기 전에 메모리를 검토하고 편집할 수 있는 미리보기 팝업을 활성화합니다.
- **알림 표시:** 토스트 메시지를 토글합니다.
- **편집기 새로고침:** 메모리 생성 후 로어북 편집기를 자동으로 새로고침합니다.
- **토큰 경고 임계값:** 큰 장면에 대한 경고 수준을 설정합니다 (기본값: 30,000).
- **기본 이전 메모리:** 컨텍스트로 포함할 이전 메모리 수 (0-7).
- **메모리 요약 자동 생성:** 간격에 따라 자동 메모리 생성을 활성화합니다.
- **자동 요약 간격:** 자동으로 메모리 요약을 생성할 메시지 수 (10-200, 기본값: 100).
- **메모리 제목 형식:** 선택하거나 사용자 지정합니다 (아래 참조).

![프로필 구성](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/Profile.png)

### **프로필 필드**
- **이름:** 표시 이름.
- **API/제공자:** openai, claude, custom 등.
- **모델:** 모델 이름 (예: gpt-4, claude-3-opus).
- **온도:** 0.0–2.0.
- **프롬프트 또는 사전 설정:** 사용자 지정 또는 내장.
- **제목 형식:** 프로필별 템플릿.
- **활성화 모드:** 벡터화, 상수, 보통.
- **위치:** ↑Char, ↓Cha, ↑EM, ↓EM, ↑AN.
- **순서 모드:** 자동/수동.
- **재귀:** 재귀 방지/지연.

---

## 🏷️ 제목 서식

강력한 템플릿 시스템을 사용하여 로어북 항목의 제목을 사용자 지정합니다.

- **플레이스홀더:**
  - `{{title}}` - AI가 생성한 제목 (예: "운명적인 만남").
  - `{{scene}}` - 메시지 범위 (예: "장면 15-23").
  - `{{char}}` - 캐릭터 이름.
  - `{{user}}` - 사용자 이름.
  - `{{messages}}` - 장면에 있는 메시지 수.
  - `{{profile}}` - 생성에 사용된 프로필 이름.
  - 다양한 형식의 현재 날짜/시간 플레이스홀더 (예: 날짜의 경우 `2025년 8월 13일`, 시간의 경우 `오후 11:08`).
- **자동 번호 매기기:** 순차적이고 0으로 채워진 번호 매기기를 위해 `[0]`, `[00]`, `(0)`, `{0}`, `#0` 및 이제 `#[000]`, `([000])`, `{[000]}`와 같은 래핑된 형식도 사용합니다.
- **사용자 지정 형식:** 자신만의 형식을 만들 수 있습니다. v4.5.1부터 모든 인쇄 가능한 유니코드 문자(이모지, CJK, 악센트, 기호 등 포함)가 제목에 허용됩니다. 유니코드 제어 문자만 차단됩니다.

---

## 🧵 컨텍스트 메모리

- **최대 7개의 이전 메모리 포함**하여 더 나은 연속성을 위한 컨텍스트로 사용합니다.
- **토큰 추정**은 정확성을 위해 컨텍스트 메모리를 포함합니다.

![컨텍스트가 포함된 메모리 생성](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/context.png)

---

## 🎨 시각적 피드백 및 접근성

- **버튼 상태:**
  - 비활성, 활성, 유효한 선택, 장면 내, 처리 중.

![모든 시각적 상태를 보여주는 완전한 장면 선택](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/example.png)


- **접근성:**
  - 키보드 탐색, 포커스 표시기, ARIA 속성, 모션 감소, 모바일 친화적.

---

## 🛠️ 문제 해결

- **사용 가능한 로어북이 없거나 선택되지 않음:**
  - 수동 모드에서는 메시지가 표시될 때 로어북을 선택합니다.
  - 자동 모드에서는 채팅에 로어북을 바인딩합니다.
  - 또는 자동 생성을 위해 "로어북이 없으면 자동 생성"을 활성화합니다.

- **선택된 장면 없음:**
  - 시작(►)과 끝(◄) 지점을 모두 표시합니다.

- **장면이 기존 메모리와 겹침:**
  - 다른 범위를 선택하거나 설정에서 "장면 중첩 허용"을 활성화합니다.

![장면 중첩 경고](https://github.com/aikohanasaki/imagehost/blob/main/STMemoryBooks/overlap.png)

- **AI가 유효한 메모리를 생성하지 못함:**
  - JSON 출력을 지원하는 모델을 사용합니다.
  - 프롬프트 및 모델 설정을 확인합니다.

- **토큰 경고 임계값 초과:**
  - 더 작은 장면을 사용하거나 임계값을 높입니다.

- **쉐브론 버튼 누락:**
  - 확장 프로그램이 로드될 때까지 기다리거나 새로고침합니다.

- **캐릭터 데이터를 사용할 수 없음:**
  - 채팅/그룹이 완전히 로드될 때까지 기다립니다.

---

## 📝 문자 정책 (v4.5.1+)

- **제목에 허용:** 악센트가 있는 문자, 이모지, CJK 및 기호를 포함한 모든 인쇄 가능한 유니코드 문자가 허용됩니다.
- **차단:** 유니코드 제어 문자(U+0000–U+001F, U+007F–U+009F)만 차단되며, 이들은 자동으로 제거됩니다.

예시 및 마이그레이션 참고 사항은 [문자 정책 세부 정보](charset.md)를 참조하세요.
---

*VS Code/Cline, 광범위한 테스트 및 커뮤니티 피드백을 사용하여 사랑으로 개발되었습니다.* 🤖💕
