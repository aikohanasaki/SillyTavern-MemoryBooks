# 📕 ST 记忆书 - 你的 AI 聊天记忆助手
(This document is AI translated.)

**把你无尽的聊天对话变成有组织的、可搜索的记忆！**

需要机器人记住事情，但聊天内容太长，无法放入上下文？想要自动追踪重要的情节要点，而不用手动做笔记？ST 记忆书正是为此而生——它会观察你的聊天并创建智能摘要，让你再也不会忘记故事的进展。

---

## 🚀 快速入门 (5 分钟内创建你的第一个记忆！)

**刚接触 ST 记忆书？** 让我们通过几次点击，帮助你设置第一个自动记忆：

### 第 1 步：找到扩展
- 在你的聊天输入框旁边寻找魔术棒图标 (🪄)
- 点击它，然后点击 **"记忆书"**
- 你会看到 ST 记忆书的控制面板

### 第 2 步：开启自动魔法
- 在控制面板中，找到 **"自动摘要"**
- 将其开启
- 设置为每 **20-30 条消息** 创建一次记忆 (这是一个很好的起点)
- 就这样！🎉

### 第 3 步：正常聊天
- 像往常一样继续聊天
- 在 20-30 条新消息后，ST 记忆书将自动：
  - 选择最佳的场景边界
  - 请求你的 AI 撰写摘要
  - 将其保存到你的记忆收集中
  - 完成后向你显示通知

**恭喜！** 你现在拥有了自动化的记忆管理。再也不用担心忘记几个章节前发生的事情了！

---

## 💡 ST 记忆书究竟是做什么的

把 ST 记忆书想象成你的 **个人 AI 图书管理员**，专门管理聊天对话：

### 🤖 **自动摘要**
*"我不想考虑那么多，让它自动工作就行"*
- 在后台观察你的聊天
- 每隔 X 条消息自动创建记忆
- 非常适合长篇角色扮演、创意写作或持续进行的故事

### ✋ **手动创建记忆**
*"我想控制保存哪些内容"*
- 使用简单的箭头按钮 (► ◄) 标记重要的场景
- 为特殊时刻按需创建记忆
- 非常适合捕捉关键情节要点或角色发展

### 📊 **侧边提示和智能追踪器**
*"我想追踪关系、情节线索或统计数据"*
- 可重复使用的提示片段，用于增强记忆生成
- 内置模板库，提供即用型追踪器
- 自定义 AI 提示，可以追踪任何你想要的内容
- 自动更新记分牌、关系状态、情节摘要
- 示例："谁喜欢谁？"、"当前任务状态"、"角色情绪追踪器"

### 📚 **记忆集**
*你所有记忆的存放处*
- 自动整理和搜索
- 与 SillyTavern 内置的知识库系统协同工作
- 你的 AI 可以在新的对话中引用过去的记忆

---

## 🎯 选择你的风格

<details>
<summary><strong>🔄 "设置后不管" (推荐给初学者)</strong></summary>

**如果你想要：** 无需干预的自动化，一切自动完成

**工作原理：**
1. 在设置中开启 "自动摘要"
2. 选择创建记忆的频率 (每 20-50 条消息效果很好)
3. 正常聊天——记忆会自动生成！

**你会得到：**
- 无需手动操作
- 持续的记忆创建
- 不会错过重要的故事节点
- 在单人聊天和群聊中都有效

**专业提示：** 从 30 条消息开始，然后根据你的聊天风格进行调整。快节奏的聊天可能需要 50+，而慢节奏的详细聊天可能更适合 20。

</details>

<details>
<summary><strong>✋ "手动控制" (用于选择性记忆制作)</strong></summary>

**如果你想要：** 精确决定什么内容成为记忆

**工作原理：**
1. 在你的聊天消息上寻找小的箭头按钮 (► ◄)
2. 在重要场景的第一条消息上点击 ►
3. 在该场景的最后一条消息上点击 ◄
4. 打开记忆书 (🪄) 并点击 "创建记忆"

**你会得到：**
- 完全控制记忆内容
- 完美捕捉特定时刻
- 非常适合需要仔细界定的复杂场景

**专业提示：** 箭头按钮在加载聊天几秒钟后出现。如果你没有看到它们，请稍等片刻或刷新页面。

</details>

<details>
<summary><strong>⚡ "高级用户" (斜杠命令)</strong></summary>

**如果你想要：** 键盘快捷键和高级功能

**基本命令：**
- `/scenememory 10-25` - 从消息 10 到 25 创建记忆
- `/creatememory` - 从当前标记的场景创建记忆
- `/nextmemory` - 总结自上次记忆以来的所有内容
- `/sideprompt "关系追踪器"` - 运行自定义追踪器

**你会得到：**
- 闪电般快速的记忆创建
- 批量操作
- 与自定义工作流程集成

</details>

---

## 🎨 侧边提示和模板 (高级功能)

**侧边提示** 是可重复使用的提示片段，可以在不更改你的主要 AI 设置的情况下增强你的记忆生成。把它们想象成 "附加组件"，为你的记忆提供额外的焦点或追踪能力。

### 🚀 **通过模板快速入门**
1. 打开记忆书设置
2. 点击 **"侧边提示"** 按钮
3. 浏览 **模板库** - 选择适合你故事的模板：
   - **角色发展追踪器** - 追踪个性的变化和成长
   - **关系动态** - 监控角色之间的关系
   - **情节线索追踪器** - 跟踪正在进行的故事线
   - **情绪与氛围** - 捕捉场景的情感基调
   - **世界观笔记** - 记录设定的细节和传说
4. 启用你想要的模板，如果需要可以进行自定义
5. 你的记忆现在将自动包含这些额外的追踪信息！

### ⚙️ **侧边提示的工作原理**
- **非侵入性**：它们不会更改你的主要 AI 设置或角色提示
- **按聊天控制**：为不同的聊天启用不同的提示
- **基于模板**：使用预构建的模板或创建自定义模板
- **自动集成**：一旦启用，它们会增强创建的每一个记忆

### 🛠️ **管理侧边提示**
- **侧边提示管理器**：创建、编辑、复制和整理你的提示
- **导入/导出**：与他人共享提示模板或备份你的收藏
- **快速切换**：在侧边提示弹出窗口中即时启用/禁用提示
- **实时预览**：查看当前聊天激活了哪些提示

### 💡 **模板示例**
- 侧边提示模板库 (导入此 JSON): [SidePromptTemplateLibrary.json](/resources/SidePromptTemplateLibrary.json)
- **"专注于对话和角色互动"**
- **"追踪当前任务状态和目标"**
- **"记录提到的任何世界观细节"**
- **"监控 [角色 A] 和 [角色 B] 之间的关系"**

### 🔧 **创建自定义侧边提示**
1. 打开侧边提示管理器
2. 点击 "创建新的"
3. 编写你的提示 (例如："始终记录每个场景中的天气情况")
4. 保存并启用它
5. 现在你所有的记忆都将包含天气追踪！

**专业提示**：侧边提示在具体和专注时效果最佳。与其 "追踪一切"，不如试试 "追踪主角之间的浪漫张力"。

---

### 🧠 使用 Regex 扩展进行高级文本控制

**想要对发送给 AI 和从 AI 接收的文本拥有最终控制权吗？** ST 记忆书现在与官方的 **Regex** 扩展无缝集成，允许您使用自定义规则自动转换文本。

这是一个高级功能，非常适合希望实现以下目标的用户：
- 自动清理 AI 响应中的重复短语或残留内容。
- 在 AI 看到聊天记录之前重新格式化部分内容。
- 即时标准化术语或角色行为。

#### **工作原理：两个简单的挂钩**

该集成通过在两个关键点应用您启用的正则表达式脚本来工作。您可以通过在 Regex 扩展的编辑器中设置它们的 **位置** 来控制哪些脚本运行：

1.  **修改提示（传出文本）**
    *   **要使用的位置**：`User Input`
    *   **功能**：在为记忆或侧边提示生成发送给 AI 之前，拦截完全组装好的提示（包括聊天记录、系统指令等）。
    *   **使用示例**：您可以创建一个脚本，自动将角色昵称的所有实例替换为其全名，以确保 AI 具有正确的上下文。

2.  **修改响应（传入文本）**
    *   **要使用的位置**：`AI Output`
    *   **功能**：在 AI 的原始文本响应被解析或保存为记忆*之前*拦截它。
    *   **使用示例**：如果您的 AI 模型经常在其摘要中包含诸如*“作为一个大型语言模型...”*之类的重复短语，您可以创建一个正则表达式脚本，从它生成的每个记忆中自动删除此短语。

#### **快速入门示例：清理 AI 响应**

假设您的 AI 模型在其记忆生成中始终添加 `(OOC: 希望这个摘要有帮助！)`。以下是如何自动删除它：

1.  **转到 Regex 扩展**：打开主 SillyTavern 扩展菜单，然后转到 **Regex**。
2.  **创建新脚本**：点击“打开 Regex 编辑器”以创建新的正则表达式脚本。
3.  **配置脚本**：
    *   **脚本名称**：`清理 OOC 注释`
    *   **查找 Regex**：`/\\(OOC:.*?\\)/g`（这将查找文本“(OOC: ...)”及其中的所有内容）。
    *   **替换字符串**：将此留空以删除匹配的文本。
    *   **影响（位置）**：取消选中除 **AI Output** 之外的所有框。这是最重要的一步！
    *   **启用脚本**：确保脚本未被禁用。
4.  **保存并完成！**

现在，每当 ST 记忆书从 AI 获得响应时，此脚本将自动运行，在将记忆保存到您的知识库之前清除不需要的文本。

---

## ⚙️ 真正重要的设置

别担心——你不需要配置所有东西！以下是产生最大影响的设置：

### 🎛️ **自动摘要频率**
- **20-30 条消息**：非常适合详细、慢节奏的聊天
- **40-60 条消息**：完美适用于快节奏、充满动作的对话
- **80+ 条消息**：适用于非常快的群聊或休闲对话

### 📝 **记忆预览**
- 开启此项以在记忆保存前进行审查
- 如果 AI 遗漏了重要内容，你可以编辑、批准或重新生成
- 推荐用于重要的故事情节

### 🏷️ **记忆标题**
- 自定义你的记忆命名方式
- 使用 `{{title}}` 表示 AI 生成的标题，`{{scene}}` 表示消息编号
- 示例：`"章节 {{title}} ({{scene}})"` 变为 `"章节 大逃亡 (场景 45-67)"`

### 📚 **记忆集** (知识库)
- **自动模式**：使用你聊天的默认记忆集 (最简单)
- **手动模式**：为每个聊天选择一个特定的记忆集 (用于整理)
- **自动创建**：自动创建新的记忆集 (适合新角色)

---

## 🔧 故障排除 (当出现问题时)

### "我没有看到记忆书选项！"
- 检查扩展是否已安装并启用
- 在你的聊天输入框旁边寻找魔术棒 (🪄) 图标
- 尝试刷新页面

### "箭头按钮 (► ◄) 没有显示！"
- 加载聊天后等待 3-5 秒——它们需要时间出现
- 如果仍然没有，刷新页面
- 确保 ST 记忆书在扩展中已启用

### "自动摘要不工作！"
- 再次检查记忆书设置中的 "自动摘要" 是否已启用
- 是否已达到消息间隔？自动摘要会等待足够的新消息
- 如果你推迟了自动摘要，它可能会等到某个消息计数
- 自动摘要只处理自*上次*记忆以来的新消息。如果你删除了旧记忆，它不会追溯。

### "我收到关于缺少知识库的错误！"
- 前往记忆书设置
- 要么将一个知识库绑定到你的聊天 (自动模式)，要么启用 "如果不存在则自动创建知识库"

### "有时它会无缘无故地失败！"
- 确保你的最大响应长度（在 SillyTavern 预设中）设置得足够大。Aiko 建议至少 2000 个 tokens（Aiko 自己使用 4000）。
- 现在的错误信息更详细了，但如果你仍然遇到问题，请在 Github 或 Discord 上联系 Aiko。

### "我的自定义提示不正常工作！"
- 检查记忆书设置中的 "摘要提示管理器"
- 确保你的提示指示 AI 以 **JSON 格式** 响应 (例如：`{ "title": "...", "content": "..." }`)

---

## 🚫 ST 记忆书不做什么

- **不是通用的知识库编辑器：** 本指南专注于由 STMB 创建的条目。对于通用的知识库编辑，请使用 SillyTavern 内置的知识库编辑器。

---

## 💡 获取帮助和更多信息

- **更详细的信息：** [readme.md](readme.md)
- **最新更新：** [changelog.md](changelog.md)
- **转换旧的知识库：** [lorebookconverter.html](lorebookconverter.html)
- **社区支持：** 加入 SillyTavern 的 Discord 社区！(寻找 📕ST 记忆书 频道或直接私信 @tokyoapple 寻求帮助。)
- **错误/功能：** 发现了一个错误或有一个好主意？在此存储库中提交一个 GitHub issue。
