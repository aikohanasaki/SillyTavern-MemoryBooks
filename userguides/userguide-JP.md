# 📕 STメモリーブック - あなたのAIチャット記憶アシスタント

**終わりのないチャットの会話を、整理された検索可能な記憶に変えましょう！**

ボットに物事を覚えていてもらいたいけれど、チャットが長すぎてコンテキストに入りきらない？手動でメモを取らずに重要なプロットポイントを自動的に追跡したい？STメモリーブックはまさにそれを実現します - チャットを監視し、スマートな要約を作成することで、物語の筋道を見失うことがなくなります。

---

## 🚀 クイックスタート（5分で最初の記憶を作成！）

**STメモリーブックは初めてですか？** 数クリックで最初の自動記憶を設定しましょう：

### ステップ1：拡張機能を見つける
- チャット入力ボックスの隣にある魔法の杖のアイコン（🪄）を探します
- それをクリックし、**「メモリーブック」**をクリックします
- STメモリーブックのコントロールパネルが表示されます

### ステップ2：自動マジックをオンにする
- コントロールパネルで**「自動要約」**を見つけます
- それをオンにします
- **20〜30メッセージ**ごとに記憶を作成するように設定します（これが良い出発点です）
- これで完了です！🎉

### ステップ3：通常通りチャットする
- いつも通りチャットを続けます
- 20〜30の新しいメッセージの後、STメモリーブックは自動的に：
  - 最適なシーンの境界を選択します
  - AIに要約を作成するよう依頼します
  - それをあなたの記憶コレクションに保存します
  - 完了したら通知を表示します

**おめでとうございます！** これで自動記憶管理ができました。何章も前に何が起こったかを忘れることはもうありません！

---

## 💡 STメモリーブックが実際に何をするか

STメモリーブックを、チャット会話のための**あなたの個人的なAI司書**と考えてください：

### 🤖 **自動要約**
*「考えたくない、ただ動いてほしい」*
- バックグラウンドでチャットを監視します
- Xメッセージごとに自動的に記憶を作成します
- 長いロールプレイ、クリエイティブライティング、または進行中の物語に最適です

### ✋ **手動での記憶作成**
*「保存する内容を自分でコントロールしたい」*
- 簡単な矢印ボタン（► ◄）で重要なシーンをマークします
- 特別な瞬間のためにオンデマンドで記憶を作成します
- 主要なプロットポイントやキャラクターの成長を捉えるのに最適です

### 📊 **サイドプロンプト＆スマートトラッカー**
*「関係性、プロットの筋、または統計を追跡したい」*
- 記憶生成を強化する再利用可能なプロンプトスニペット
- すぐに使えるトラッカーを備えた組み込みテンプレートライブラリ
- 好きなものを何でも追跡するカスタムAIプロンプト
- スコアボード、関係状況、プロットの要約を自動的に更新します
- 例：「誰が誰を好きか？」、「現在のクエスト状況」、「キャラクターの気分トラッカー」

### 📚 **記憶コレクション**
*すべての記憶が保存される場所*
- 自動的に整理され、検索可能です
- SillyTavernの組み込みロアブックシステムと連携します
- あなたのAIは新しい会話で過去の記憶を参照できます

---

## 🎯 あなたのスタイルを選ぶ

<details>
<summary><strong>🔄 「設定して忘れる」（初心者におすすめ）</strong></summary>

**こんな方に最適：** 手間いらずでただ機能する自動化を求める方

**仕組み：**
1. 設定で「自動要約」をオンにします
2. 記憶を作成する頻度を選択します（20〜50メッセージごとがうまく機能します）
3. 通常通りチャットを続けます - 記憶は自動的に作成されます！

**得られるもの：**
- 手作業は不要です
- 一貫した記憶作成
- 重要な物語の展開を見逃しません
- 個人チャットとグループチャットの両方で機能します

**プロのヒント：** 30メッセージから始めて、チャットのスタイルに合わせて調整してください。速いチャットなら50以上、遅くて詳細なチャットなら20を好むかもしれません。

</details>

<details>
<summary><strong>✋ 「手動コントロール」（選択的な記憶作成用）</strong></summary>

**こんな方に最適：** 何を記憶にするかを正確に決めたい方

**仕組み：**
1. チャットメッセージにある小さな矢印ボタン（► ◄）を探します
2. 重要なシーンの最初のメッセージで►をクリックします
3. そのシーンの最後のメッセージで◄をクリックします
4. メモリーブック（🪄）を開き、「記憶を作成」をクリックします

**得られるもの：**
- 記憶の内容を完全にコントロールできます
- 特定の瞬間を捉えるのに最適です
- 慎重な境界設定が必要な複雑なシーンに最適です

**プロのヒント：** 矢印ボタンはチャットを読み込んでから数秒後に表示されます。表示されない場合は、少し待つかページを更新してください。

</details>

<details>
<summary><strong>⚡ 「パワーユーザー」（スラッシュコマンド）</strong></summary>

**こんな方に最適：** キーボードショートカットや高度な機能を求める方

**主要なコマンド：**
- `/scenememory 10-25` - メッセージ10から25までの記憶を作成します
- `/creatememory` - 現在マークされているシーンから記憶を作成します
- `/nextmemory` - 最後の記憶以降のすべてを要約します
- `/sideprompt "関係トラッカー"` - カスタムトラッカーを実行します

**得られるもの：**
- 超高速な記憶作成
- バッチ操作
- カスタムワークフローとの統合

</details>

---

## 🎨 サイドプロンプト＆テンプレート（高度な機能）

**サイドプロンプト**は、メインのAI設定を変更せずに記憶生成を強化する再利用可能なプロンプトスニペットです。記憶に特別な焦点や追跡機能を与える「アドオン」と考えてください。

### 🚀 **テンプレートでクイックスタート**
1. メモリーブックの設定を開きます
2. **「サイドプロンプト」**ボタンをクリックします
3. **テンプレートライブラリ**を閲覧し、あなたの物語に合うものを選びます：
   - **キャラクター成長トラッカー** - 性格の変化と成長を追跡します
   - **関係性のダイナミクス** - キャラクター間の関係を監視します
   - **プロット筋トラッカー** - 進行中のストーリーラインを追跡します
   - **ムード＆雰囲気** - シーンの感情的なトーンを捉えます
   - **世界構築ノート** - 設定の詳細と伝承を記録します
4. 必要なテンプレートを有効にし、必要に応じてカスタマイズします
5. これであなたの記憶には、この追加の追跡が自動的に含まれるようになります！

### ⚙️ **サイドプロンプトの仕組み**
- **非侵入的**：メインのAI設定やキャラクタープロンプトを変更しません
- **チャットごとの制御**：チャットごとに異なるプロンプトを有効にできます
- **テンプレートベース**：既製のテンプレートを使用するか、カスタムテンプレートを作成します
- **自動統合**：有効にすると、作成されるすべての記憶が強化されます

### 🛠️ **サイドプロンプトの管理**
- **サイドプロンプトマネージャー**：プロンプトの作成、編集、複製、整理
- **インポート/エクスポート**：他の人とプロンプトテンプレートを共有したり、コレクションをバックアップしたりできます
- **クイックトグル**：サイドプロンプトポップアップでプロンプトを即座に有効/無効にできます
- **ライブプレビュー**：現在のチャットでアクティブなプロンプトを確認できます

### 💡 **テンプレートの例**
- サイドプロンプトテンプレートライブラリ（このJSONをインポート）：[SidePromptTemplateLibrary.json](/resources/SidePromptTemplateLibrary.json)
- **「対話とキャラクターの相互作用に焦点を当てる」**
- **「現在のクエスト状況と目標を追跡する」**
- **「言及された世界構築の詳細をメモする」**
- **「[キャラクターA]と[キャラクターB]の関係を監視する」**

### 🔧 **カスタムサイドプロンプトの作成**
1. サイドプロンプトマネージャーを開きます
2. 「新規作成」をクリックします
3. プロンプトを作成します（例：「各シーンの天気を常にメモする」）
4. 保存して有効にします
5. これで、すべての記憶に天気の追跡が含まれるようになります！

**プロのヒント**：サイドプロンプトは、具体的で焦点が絞られている場合に最も効果的です。「すべてを追跡する」のではなく、「主要キャラクター間の恋愛感情の緊張を追跡する」のようにしてみてください。

---

### 🧠 Regex拡張機能による高度なテキスト制御

**AIに送信されるテキストとAIから受信されるテキストを究極的に制御したいですか？** STメモリーブックは、公式の**Regex**拡張機能とシームレスに統合され、カスタムルールを使用してテキストを自動的に変換できます。

これは、次のようなユーザーに最適な高度な機能です：
- AIの応答から反復的なフレーズやアーティファクトを自動的にクリーンアップしたい。
- AIが見る前にチャットのトランスクリプトの一部を再フォーマットしたい。
- 専門用語やキャラクターの癖をその場で標準化したい。

#### **仕組み：2つのシンプルなフック**

この統合は、有効にした正規表現スクリプトを2つの重要なポイントで適用することによって機能します。どのスクリプトを実行するかは、Regex拡張機能のエディタで**配置**を設定することで制御します：

1.  **プロンプトの変更（送信テキスト）**
    *   **使用する配置**：`User Input`
    *   **機能**：完全に組み立てられたプロンプト（チャット履歴、システム指示などを含む）を、メモリまたはサイドプロンプト生成のためにAIに送信する直前にインターセプトします。
    *   **使用例**：キャラクターのニックネームのすべてのインスタンスをフルネームに自動的に置き換えるスクリプトを作成して、AIが適切なコンテキストを持つようにすることができます。

2.  **応答の変更（受信テキスト）**
    *   **使用する配置**：`AI Output`
    *   **機能**：AIからの生のテキスト応答を、メモリとして解析または保存される*前*にインターセプトします。
    *   **使用例**：AIモデルが要約に「大規模言語モデルとして...」のような反復的なフレーズを頻繁に含める場合、生成するすべてのメモリからこのフレーズを自動的に削除する正規表現スクリプトを作成できます。

#### **クイックスタート例：AI応答のクリーニング**

AIモデルが一貫してメモリ生成に`(OOC: この要約がお役に立てば幸いです！)`を追加するとします。これを自動的に削除する方法は次のとおりです：

1.  **Regex拡張機能に移動**：メインのSillyTavern拡張機能メニューを開き、**Regex**に移動します。
2.  **新しいスクリプトを作成**：「Regexエディタを開く」をクリックして、新しい正規表現スクリプトを作成します。
3.  **スクリプトを設定**：
    *   **スクリプト名**：`OOCノートをクリーンアップ`
    *   **検索Regex**：`/\\(OOC:.*?\\)/g`（これはテキスト「(OOC: ...)」とその中のすべてを見つけます）。
    *   **置換文字列**：一致したテキストを削除するために空白のままにします。
    *   **影響（配置）**：**AI Output**以外のすべてのボックスのチェックを外します。これが最も重要なステップです！
    *   **スクリプトを有効にする**：スクリプトが無効になっていないことを確認してください。
4.  **保存して完了！**

これで、STメモリーブックがAIから応答を受け取るたびに、このスクリプトが自動的に実行され、メモリがロアブックに保存される前に不要なテキストがクリーンアップされます。

---

## ⚙️ 本当に重要な設定

心配しないでください - すべてを設定する必要はありません！最も違いを生む設定は次のとおりです：

### 🎛️ **自動要約の頻度**
- **20〜30メッセージ**：詳細で遅いチャットに最適です
- **40〜60メッセージ**：速くてアクション満載の会話に最適です
- **80メッセージ以上**：非常に速いグループチャットやカジュアルな会話向けです

### 📝 **記憶のプレビュー**
- これをオンにすると、保存する前に記憶を確認できます
- AIが重要なことを見逃した場合、編集、承認、または再生成できます
- 重要なストーリーラインにおすすめです

### 🏷️ **記憶のタイトル**
- 記憶の命名方法をカスタマイズします
- AIが生成したタイトルには`{{title}}`、メッセージ番号には`{{scene}}`を使用します
- 例：`"第{{title}}章（シーン{{scene}}）"`は`"第 大脱走章（シーン45-67）"`になります

### 📚 **記憶コレクション**（ロアブック）
- **自動モード**：チャットのデフォルトの記憶コレクションを使用します（最も簡単）
- **手動モード**：各チャットに特定のコレクションを選択します（整理のため）
- **自動作成**：新しいコレクションを自動的に作成します（新しいキャラクターに良い）

---

## 🔧 トラブルシューティング（うまくいかないとき）

### 「メモリーブックのオプションが表示されません！」
- 拡張機能がインストールされ、有効になっていることを確認してください
- チャット入力の隣にある魔法の杖（🪄）アイコンを探してください
- ページを更新してみてください

### 「矢印ボタン（► ◄）が表示されません！」
- チャットを読み込んでから3〜5秒待ってください - 表示されるまでに時間がかかります
- それでも表示されない場合は、ページを更新してください
- STメモリーブックが拡張機能で有効になっていることを確認してください

### 「自動要約が機能しません！」
- メモリーブックの設定で「自動要約」が有効になっていることを再確認してください
- メッセージ間隔に達しましたか？自動要約は十分な新しいメッセージを待ちます
- 自動要約を延期した場合、特定のメッセージ数まで待機している可能性があります
- 自動要約は*最後の*記憶以降の新しいメッセージのみを処理します。古い記憶を削除した場合、さかのぼって処理はしません。

### 「ロアブックが見つからないというエラーが出ます！」
- メモリーブックの設定に移動します
- チャットにロアブックをバインドする（自動モード）か、「ロアブックが存在しない場合に自動作成」を有効にします

### 「理由もなく失敗することがあります！」
- SillyTavernのプリセットで最大応答長が十分に大きな数に設定されていることを確認してください。Aikoは少なくとも2000トークンを推奨しています（Aikoは4000で実行しています）。
- エラーメッセージは現在より詳細になっていますが、それでも問題が解決しない場合は、GithubまたはDiscordでAikoに連絡してください。

### 「カスタムプロンプトが正しく機能しません！」
- メモリーブックの設定で「要約プロンプトマネージャー」を確認してください
- プロンプトがAIに**JSON形式**で応答するように指示していることを確認してください（例：`{ "title": "...", "content": "..." }`）

---

## 🚫 STメモリーブックがしないこと

- **一般的なロアブックエディタではありません：** このガイドはSTMBによって作成されたエントリに焦点を当てています。一般的なロアブックの編集には、SillyTavernの組み込みロアブックエディタを使用してください。

---

## 💡 ヘルプと詳細情報

- **詳細情報：** [readme.md](readme.md)
- **最新の更新：** [changelog.md](changelog.md)
- **古いロアブックの変換：** [lorebookconverter.html](lorebookconverter.html)
- **コミュニティサポート：** DiscordのSillyTavernコミュニティに参加してください！（📕STメモリーブックスレッドを探すか、@tokyoappleにDMで直接助けを求めてください。）
- **バグ/機能：** バグを見つけたり、素晴らしいアイデアがありますか？このリポジトリでGitHubイシューを開いてください。
