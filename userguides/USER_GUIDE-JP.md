# 📕 ST Memory Books - AIチャット記憶アシスタント

**終わりのないチャット会話を、整理された検索可能な「思い出」に変えましょう！**

ボットに覚えていてほしいことがあるけれど、チャットが長すぎてコンテキストに収まらない？手動でメモを取ることなく、重要なプロットポイントを自動的に追跡したい？ST Memory Books (STMB) はまさにそのためにあります。チャットを監視し、スマートな要約を作成するため、ストーリーの進行を見失うことはもうありません。

（技術的な詳細を知りたいですか？その場合は [STMBの仕組み (英語)](https://www.google.com/search?q=userguides/howSTMBworks-en.md) をご覧ください。）

---

## 🚀 クイックスタート（最初のメモリ作成まで5分！）

**ST Memory Booksは初めてですか？** わずか数クリックで、最初の自動メモリを設定しましょう：

### ステップ 1: 拡張機能を見つける

* チャット入力欄の横にある魔法の杖アイコン (🪄) を探してください。
* それをクリックし、**"Memory Books"** を選択します。
* ST Memory Booksのコントロールパネルが表示されます。

### ステップ 2: 自動化（Auto-Magic）をオンにする

* コントロールパネルで **"Auto-Summary" (自動要約)** を見つけます。
* これを **ON** にします。
* メモリ作成頻度を **20～30メッセージごと** に設定します（最初はこれがおすすめです）。
* これだけです！🎉

### ステップ 3: 普通にチャットする

* いつも通りチャットを続けてください。
* 20～30件の新しいメッセージがたまると、ST Memory Booksは自動的に以下を実行します：
* 最適なシーンの区切りを選択
* AIに要約の執筆を依頼
* メモリコレクションに保存
* 完了時に通知を表示



**おめでとうございます！** これで自動メモリ管理ができるようになりました。数章前の出来事を忘れてしまうことはもうありません！

---

## 💡 ST Memory Books が実際にすること

ST Memory Booksは、チャット会話のための **専属AI司書** だと考えてください：

### 🤖 **自動サマリー (Automatic Summaries)**

*「余計なことは考えたくない、とにかく動いてほしい」*

* バックグラウンドでチャットを監視します。
* Xメッセージごとに自動的にメモリを作成します。
* 長編ロールプレイ、クリエイティブライティング、進行中のストーリーに最適です。

### ✋ **手動メモリ作成 (Manual Memory Creation)**

*「保存する内容は自分でコントロールしたい」*

* 重要なシーンをシンプルな矢印ボタン (► ◄) でマークします。
* 特別な瞬間のために、オンデマンドでメモリを作成します。
* 重要なプロットポイントやキャラクターの展開を捉えるのに最適です。

### 📊 **サイドプロンプトとスマートトラッカー**

*「人間関係、プロットの伏線、ステータスを追跡したい」*

* メモリ生成を強化する再利用可能なプロンプトスニペットです。
* すぐに使えるトラッカーを含むテンプレートライブラリがあります。
* 何でも追跡できるカスタムAIプロンプトを作成可能です。
* スコアボード、関係ステータス、プロット概要を自動更新します。
* 例：「誰が誰を好きか？」「現在のクエスト状況」「キャラクターの気分トラッカー」

### 📚 **メモリコレクション (Memory Collections)**

*すべての思い出が生きる場所*

* 自動的に整理され、検索可能になります。
* SillyTavern内蔵のLorebook（ロアブック）システムと連携します。
* AIは新しい会話の中で過去のメモリを参照できます。

---

## 🎯 スタイルの選択

<details>
<summary><strong>🔄 "Set and Forget" 完全自動（初心者におすすめ）</strong></summary>

**こんな方に最適:** 手間をかけずに自動化したい方

**使い方:**

1. 設定で "Auto-Summary" をオンにします。
2. メモリ作成頻度を選択します（20～50メッセージごとが推奨）。
3. 普通にチャットを続けます - メモリは自動的に生成されます！

**メリット:**

* 手動作業は不要
* 一貫したメモリ作成
* 重要なストーリー展開を見逃さない
* シングルチャットとグループチャットの両方で動作

**プロのヒント:** 最初は30メッセージから始め、チャットスタイルに合わせて調整してください。早い展開のチャットは50以上、ゆっくりとした詳細なチャットは20程度が良いでしょう。

</details>

<details>
<summary><strong>✋ "Manual Control" 手動コントロール（こだわり派）</strong></summary>

**こんな方に最適:** 何をメモリにするか正確に決めたい方

**使い方:**

1. チャットメッセージ上の小さな矢印ボタン (► ◄) を探します。
2. 重要なシーンの最初のメッセージで ► をクリックします。
3. そのシーンの最後のメッセージで ◄ をクリックします。
4. Memory Books (🪄) を開き、"Create Memory" をクリックします。

**メリット:**

* メモリ内容の完全なコントロール
* 特定の瞬間を切り取るのに最適
* 慎重な区切りが必要な複雑なシーンに最適

**プロのヒント:** 矢印ボタンはチャット読み込みの数秒後に表示されます。表示されない場合は、少し待つかページを更新してください。

</details>

<details>
<summary><strong>⚡ "Power User" パワーユーザー（スラッシュコマンド）</strong></summary>

**こんな方に最適:** キーボードショートカットや高度な機能を使いたい方

**必須コマンド:**

* `/scenememory 10-25` - メッセージ10から25までのメモリを作成
* `/creatememory` - 現在マークされているシーンからメモリを作成
* `/nextmemory` - 前回のメモリ以降のすべてを要約
* `/sideprompt "Relationship Tracker"` - カスタムトラッカーを実行

**メリット:**

* 電光石火のメモリ作成
* バッチ処理
* カスタムワークフローとの統合

</details>

---

## 🌈 アークサマリー (Arc Summaries)

アークサマリーは手動で作成されます。あなたが選択しない限り、勝手に要約されたり削除されたりすることはありません。

### Q: アークサマリーとは何ですか？

**A:** アークサマリーは、長いストーリーを管理しやすくするための機能です。時間が経つにつれて、古いメモリ（要約）のエントリーが多数蓄積されます。それらの一部は、ストーリーの同じ部分を記述している場合があります。
アークサマリーを使用すると、複数の古いメモリを1つの短い要約に結合できます。

### Q: アークサマリーを作成するとどうなりますか？

**A:** アークサマリーを作成すると：

* 選択されたメモリが1つの新しいエントリーに結合されます。
* 新しい要約が古いメモリを置き換えます。
*（古いメモリは自動的に非表示にできます - 削除はされません）*
* ストーリーは記憶されたままですが、トークン数は少なくなります。

### Q: なぜアークサマリーを作るのですか？

**A:** アークサマリーは以下の場合に役立ちます：

* メモリリストが非常に長くなってきた場合
* 古いメモリに完全な詳細が不要になった場合
* 長いチャットでのトークン使用量を減らしたい場合

### Q: アークサマリーの作り方は？

**A:** アークサマリーを作成するには：

1. STMBメインポップアップの下部にある **🌈 Consolidate Memories into Arcs** をクリックします。
2. アークの種類を選択します：
* **Multi-Arc (マルチアーク)**
AIが自然な区切りを探し、複数のアークを作成します。
アークごとの最小メモリ数を設定できます。
*GPT, Gemini, Sonnetなどの高性能モデルに最適です。ローカルモデルでは苦戦するかもしれません。*
* **Single Arc (シングルアーク)**
選択したすべてのメモリを1つのアークに結合します。
ストーリーの一貫性を保つため、以前のアークも含まれます。
* **Tiny (タイニー)**
より高速でシンプルなオプションで、ローカルモデルでも動作しやすいですが、
結果の詳細度は低くなる可能性があります。


3. 含めたいメモリを選択します。
4. **Run** をクリックし、アーク分析が完了するのを待ちます。

---

## 🎨 トラッカー、サイドプロンプト、テンプレート（上級機能）

**サイドプロンプト (Side Prompts)** は、進行中のストーリー情報を維持するのに役立つバックグラウンドトラッカーです。
これらはメモリ作成と並行して実行され、同じノートを時間の経過とともに更新できます。**ストーリーを監視し、特定の詳細を最新の状態に保つヘルパー**と考えてください。

### 🚀 **テンプレートでクイックスタート**

1. Memory Booksの設定を開きます。
2. **Side Prompts** をクリックします。
3. **テンプレートライブラリ** を閲覧し、ストーリーに合うものを選択します：
* **Character Development Tracker** – 性格の変化や成長を追跡
* **Relationship Dynamics** – キャラクター間の関係を追跡
* **Plot Thread Tracker** – 進行中のストーリーラインを追跡
* **Mood & Atmosphere** – 感情的なトーンを追跡
* **World Building Notes** – 設定の詳細やロア（伝承）を追跡


4. 必要なテンプレートを有効にします（後でカスタマイズ可能）。
5. これで、メモリにこの追跡情報が自動的に含まれるようになります。

### ⚙️ **サイドプロンプトの仕組み**

* **バックグラウンドトラッカー**: 静かに実行され、時間の経過とともに情報を更新します。
* **非侵入的**: メインのAI設定やキャラクタープロンプトを変更しません。
* **チャットごとの制御**: チャットごとに異なるトラッカーを使用できます。
* **テンプレートベース**: 組み込みテンプレートを使用するか、独自のテンプレートを作成できます。
* **自動または手動**: 一部は自動的に実行され、他はコマンドで実行できます。

### 🛠️ **サイドプロンプトの管理**

* **Side Prompts Manager**: トラッカーの作成、編集、複製、整理を行います。
* **Enable / Disable**: いつでもトラッカーのオン/オフを切り替えられます。
* **Import / Export**: テンプレートを共有したり、バックアップしたりできます。
* **Status View**: 現在のチャットでどのトラッカーがアクティブかを確認できます。

### 💡 **テンプレートの例**

* サイドプロンプトテンプレートライブラリ（このJSONをインポート）：
[SidePromptTemplateLibrary.json](https://www.google.com/search?q=/resources/SidePromptTemplateLibrary.json)

プロンプトのアイデア例：

* 「重要な対話とキャラクターの相互作用を追跡する」
* 「現在のクエスト状況を最新に保つ」
* 「新しい世界設定の詳細が登場したら記録する」
* 「キャラクターAとキャラクターBの関係を追跡する」

### 🔧 **カスタムサイドプロンプトの作成**

1. Side Prompts Managerを開きます。
2. **Create New** をクリックします。
3. 短く明確な指示を書きます。
*（例：「各シーンの天候を常に記録する」）*
4. 保存して有効にします。
5. トラッカーは時間の経過とともにこの情報を更新します。

### 💬 **プロのヒント**

サイドプロンプトは、**小さく焦点を絞った**ときに最もよく機能します。
「すべてを追跡する」のではなく、「主人公たちの間のロマンチックな緊張感を追跡する」などを試してみてください。

---

### 🧠 Regex拡張機能による高度なテキスト制御

**AIに送信されるテキスト、およびAIから受信するテキストを究極にコントロールしたいですか？** ST Memory Booksは公式の **Regex（正規表現）** 拡張機能とシームレスに統合され、カスタムルールを使用してテキストを自動的に変換できるようになりました。

**複数選択のサポート:** Regex拡張機能でスクリプトを複数選択できるようになりました。有効なすべてのスクリプトが各段階（プロンプトとレスポンス）で順番に適用され、強力で柔軟な変換が可能になります。

これは、以下のようなことをしたい上級ユーザーに最適な機能です：

* AIの応答から繰り返しフレーズやアーティファクトを自動的にクリーンアップする。
* AIが見る前に、チャットのトランスクリプトの一部を再フォーマットする。
* 用語やキャラクターの口調をオンザフライで統一する。

#### **仕組み：2つのシンプルなフック**

この統合は、2つの重要なポイントで有効な正規表現スクリプトを適用することで機能します。Regex拡張機能のエディターで **Placement（配置）** を設定することで、どのスクリプトを実行するかを制御します：

1. **プロンプト（送信テキスト）の変更**
* **使用するPlacement**: `User Input`
* **機能**: メモリやサイドプロンプト生成のためにAIに送信される直前の、完全に組み立てられたプロンプト（チャット履歴、システム指示などを含む）を傍受します。
* **使用例**: キャラクターのニックネームをすべてフルネームに自動的に置き換えるスクリプトを作成し、AIが適切なコンテキストを持てるようにします。


2. **レスポンス（受信テキスト）の変更**
* **使用するPlacement**: `AI Output`
* **機能**: 解析されたりメモリとして保存されたりする *前* に、AIからの生のテキスト応答を傍受します。
* **使用例**: AIモデルが要約内で *"As a large language model..."（大規模言語モデルとして...）* のような繰り返しフレーズを含める場合、生成されるすべてのメモリからこのフレーズを自動的に削除するスクリプトを作成できます。



#### **クイックスタート例：AI応答のクリーニング**

AIモデルがメモリ生成時に常に `(OOC: I hope this summary is helpful!)` を追加してしまうとします。これを自動的に削除する方法は以下の通りです：

1. **Regex拡張機能へ移動**: SillyTavernのメイン拡張機能メニューを開き、**Regex** に移動します。
2. **新しいスクリプトを作成**: "Open Regex Editor" をクリックして新しいスクリプトを作成します。
3. **スクリプトの設定**:
* **Script Name**: `Clean OOC Notes`
* **Find Regex**: `/\\(OOC:.*?\\)/g` （これにより "(OOC: ...)" とその中のすべてが検索されます）。
* **Replace String**: 空欄のままにします（一致したテキストを削除するため）。
* **Affects (Placement)**: **AI Output** 以外のすべてのチェックボックスを外します。これが最も重要なステップです！
* **スクリプトを有効化**: スクリプトが無効になっていないことを確認してください。


4. **保存して完了！**

これで、ST Memory BooksがAIから応答を受け取るたびに、このスクリプトが自動的に実行され、メモリがLorebookに保存される前に不要なテキストがクリーニングされます。

---

## ⚙️ 実際に重要な設定

心配しないでください。すべてを設定する必要はありません！最も大きな違いを生む設定は以下の通りです：

### 🎛️ **Auto-Summary Frequency (自動要約の頻度)**

* **20-30 メッセージ**: 詳細でゆっくりとしたチャット向け
* **40-60 メッセージ**: 早い展開、アクション満載の会話向け
* **80+ メッセージ**: 非常に高速なグループチャットやカジュアルな会話向け

### 📝 **Memory Previews (メモリプレビュー)**

* 保存される前にメモリを確認するには、これをONにします。
* AIが重要な何かを見逃した場合、編集、承認、または再生成が可能です。
* 重要なストーリーラインにおすすめです。

### 🏷️ **Memory Titles (メモリタイトル)**

* メモリの名前付け方法をカスタマイズします。
* AI生成タイトルには `{{title}}`、メッセージ番号には `{{scene}}` を使用します。
* 例：`"Chapter {{title}} ({{scene}})"` → `"Chapter 大脱走 (Scene 45-67)"`

### 📚 **Memory Collections** (Lorebooks)

* **Auto mode**: チャットのデフォルトのメモリコレクションを使用します（最も簡単）。
* **Manual mode**: チャットごとに特定のコレクションを選択します（整理用）。
* **Auto-create**: 新しいコレクションを自動的に作成します（新しいキャラクターに最適）。

---

## 🔧 トラブルシューティング（うまくいかない時）

### 「Memory Booksのオプションが見当たりません！」

* 拡張機能がインストールされ、有効になっているか確認してください。
* チャット入力欄の横にある魔法の杖 (🪄) アイコンを探してください。
* ページを更新してみてください。

### 「矢印ボタン (► ◄) が表示されません！」

* チャット読み込み後、表示されるまで3〜5秒待ってください。
* それでも表示されない場合は、ページを更新してください。
* 拡張機能設定でST Memory Booksが有効になっているか確認してください。

### 「自動要約が機能しません！」

* Memory Books設定で "Auto-Summary" が有効になっているか再確認してください。
* メッセージ間隔に達していますか？自動要約は十分な新しいメッセージがたまるのを待ちます。
* 自動要約を延期（Postpone）した場合、特定のメッセージ数になるまで待機している可能性があります。
* 自動要約は、*前回* のメモリ以降の新しいメッセージのみを処理します。古いメモリを削除した場合、遡って処理することはありません。

### 「Lorebookが見つからないというエラーが出ます！」

* Memory Books設定に移動してください。
* Lorebookをチャットに紐付けるか（Automatic Mode）、"Auto-create lorebook if none exists"（存在しない場合Lorebookを自動作成）を有効にしてください。

### 「理由もなく失敗することがあります！」

* SillyTavernのプリセットで「Max Response Length（最大応答長）」が十分に大きな数値に設定されているか確認してください。Aikoは少なくとも2000トークンを推奨しています（Aiko本人は4000を使用）。
* エラーメッセージは以前より詳細になっていますが、それでも問題が解決しない場合は、GithubまたはDiscordでAikoに連絡してください。

### 「カスタムプロンプトが正しく機能しません！」

* Memory Books設定の "Summary Prompt Manager" を確認してください。
* プロンプトがAIに **JSON形式** で応答するように指示していることを確認してください（例: `{ "title": "...", "content": "..." }`）。

---

## 🚫 ST Memory Books がしないこと

* **一般的なLorebookエディタではありません:** このガイドはSTMBによって作成されたエントリーに焦点を当てています。一般的なLorebookの編集には、SillyTavern内蔵のLorebookエディタを使用してください。

---

## 💡 ヘルプと詳細情報

* **より詳細な情報:** [readme.md](readme.md)
* **最新の更新:** [changelog.md](changelog.md)
* **古いLorebookの変換:** [lorebookconverter.html](https://www.google.com/search?q=lorebookconverter.html)
* **コミュニティサポート:** DiscordのSillyTavernコミュニティに参加してください！（📕ST Memory Booksスレッドを探すか、直接のヘルプは @tokyoapple までDMしてください。）
* **バグ/機能要望:** バグを見つけた、または素晴らしいアイデアがありますか？このリポジトリでGitHubのIssueを開いてください。

---

### 📚 Lorebook Ordering (STLO) でパワーアップ

高度なメモリ整理とより深いストーリー統合のために、[SillyTavern-LorebookOrdering (STLO)](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering/blob/main/guides/STMB%20and%20STLO%20-%20English.md) とSTMBを併用することを強くお勧めします。ベストプラクティス、設定手順、ヒントについてはガイドをご覧ください！