# 📕 ST Memory Books - 您的 AI 聊天記憶助手

**將您無止盡的聊天對話轉化為有條理、可搜尋的記憶！**

需要機器人記住事情，但聊天記錄太長導致上下文 (Context) 超出限制？想要自動追蹤重要的劇情點，而不需要手動做筆記？ST Memory Books 正是為此而生——它會監控您的聊天內容並建立智慧摘要，讓您再也不會迷失在故事中。

(想了解幕後的技術細節？也許您需要的是 [STMB 運作原理](userguides\howSTMBworks-en.md)。)

---

## 🚀 快速開始 (5 分鐘建立您的第一個記憶！)

**剛開始使用 ST Memory Books？** 讓我們只需幾次點擊，就能設定好您的第一個自動記憶功能：

### 第一步：找到擴充功能 (Extension)
- 在您的聊天輸入框旁邊尋找魔杖圖示 (🪄)
- 點擊它，然後點選 **"Memory Books"**
- 您將會看到 ST Memory Books 的控制面板

### 第二步：開啟自動魔法 (Auto-Magic)
- 在控制面板中，找到 **"Auto-Summary" (自動摘要)**
- 將其開啟 (ON)
- 設定為每 **20-30 則訊息** 建立一次記憶 (這是不錯的起始點)
- 就這樣！ 🎉

### 第三步：正常聊天
- 像平常一樣繼續聊天
- 在累積 20-30 則新訊息後，ST Memory Books 將會自動：
  - 挑選最佳的場景分界點
  - 要求您的 AI 撰寫摘要
  - 將其儲存到您的記憶集合中
  - 完成後顯示通知給您

**恭喜！** 您現在擁有自動化的記憶管理系統了。再也不會忘記幾章之前發生的事情！

---

## 💡 ST Memory Books 實際上有什麼功能

將 ST Memory Books 想像成您聊天對話的 **個人 AI 圖書管理員**：

### 🤖 **自動摘要 (Automatic Summaries)**
*「我不想花心思管它，讓它自己運作就好」*
- 在背景監控您的聊天
- 每隔 X 則訊息自動建立記憶
- 非常適合長篇角色扮演、創意寫作或持續進行的故事

### ✋ **手動建立記憶 (Manual Memory Creation)**
*「我想要控制儲存的內容」*
- 使用簡單的箭頭按鈕 (► ◄) 標記重要場景
- 隨時為特殊時刻建立記憶
- 適合捕捉關鍵劇情點或角色發展

### 📊 **旁側提示與智慧追蹤器 (Side Prompts & Smart Trackers)**
*「我想追蹤關係、劇情線或統計數據」*
- 可重複使用的提示片段，增強記憶生成的內容
- 包含現成追蹤器的範本庫
- 自訂 AI 提示詞 (Prompts) 來追蹤任何您想要的事物
- 自動更新記分板、關係狀態、劇情大綱
- 範例：「誰喜歡誰？」、「當前任務狀態」、「角色心情追蹤器」

### 📚 **記憶集合 (Memory Collections)**
*所有記憶存放的地方*
- 自動整理且可搜尋
- 與 SillyTavern 內建的 Lorebook (世界書) 系統配合運作
- 您的 AI 可以在新的對話中參考過去的記憶

---

## 🎯 選擇您的風格

<details>
<summary><strong>🔄 「設定後即忘」 (推薦初學者)</strong></summary>

**適合對象：** 想要完全自動化、不想手動操作的使用者

**如何運作：**
1. 在設定中開啟 "Auto-Summary" (自動摘要)
2. 選擇建立記憶的頻率 (每 20-50 則訊息效果通常不錯)
3. 保持正常聊天 —— 記憶會自動產生！

**您將獲得：**
- 無需手動操作
- 持續不間斷的記憶建立
- 絕不錯過重要故事節拍
- 適用於單人及群組聊天

**專業提示：** 從 30 則訊息開始，然後根據您的聊天風格進行調整。快速的聊天可能需要 50+，較慢且詳細的聊天可能更適合 20。

</details>

<details>
<summary><strong>✋ 「手動控制」 (用於選擇性記憶製作)</strong></summary>

**適合對象：** 想要決定哪些內容變成記憶的使用者

**如何運作：**
1. 在您的聊天訊息上尋找小箭頭按鈕 (► ◄)
2. 在重要場景的第一則訊息上點擊 ►
3. 在該場景的最後一則訊息上點擊 ◄
4. 開啟 Memory Books (🪄) 並點擊 "Create Memory" (建立記憶)

**您將獲得：**
- 對記憶內容的完全控制權
- 完美捕捉特定時刻
- 非常適合需要仔細劃分界限的複雜場景

**專業提示：** 箭頭按鈕會在載入聊天幾秒鐘後出現。如果您沒看到它們，請稍等片刻或重新整理頁面。

</details>

<details>
<summary><strong>⚡ 「進階使用者」 (斜線指令)</strong></summary>

**適合對象：** 想要鍵盤快捷鍵和進階功能的使用者

**基本指令：**
- `/scenememory 10-25` - 從第 10 到 25 則訊息建立記憶
- `/creatememory` - 從目前標記的場景製作記憶
- `/nextmemory` - 總結自上次記憶以來的所有內容
- `/sideprompt "Relationship Tracker"` - 執行自訂追蹤器

**您將獲得：**
- 極速的記憶建立
- 批次操作
- 與自訂工作流程整合

</details>

---

## 🌈 篇章摘要 (Arc Summaries)

篇章摘要是手動建立的。除非您選擇這樣做，否則不會有任何內容被總結或移除。

### Q: 什麼是篇章摘要 (Arc Summaries)？

**A:** 篇章摘要有助於管理長篇故事。隨著時間推移，您可能會累積許多舊的記憶條目。其中有些描述的是故事的同一部分。
篇章摘要讓您可以將多個較舊的記憶合併為一個較短的摘要。

### Q: 製作篇章摘要時會發生什麼？

**A:** 當您建立篇章摘要時：

* 所選的記憶將合併為一個新條目
* 新的摘要將取代那些舊的記憶
  *(舊記憶可以被自動隱藏 —— 而非刪除)*
* 故事仍然被記住，但佔用的 Token 更少

### Q: 為什麼要製作篇章摘要？

**A:** 在以下情況下，篇章摘要很有用：

* 您的記憶列表變得非常長
* 不再需要舊記憶的完整細節
* 您希望在長對話中減少 Token 使用量

### Q: 如何製作篇章摘要？

**A:** 要建立篇章摘要：

1. 點擊 STMB 主彈出視窗底部的 **🌈 Consolidate Memories into Arcs (將記憶合併為篇章)**。
2. 選擇篇章類型：

   * **Multi-Arc (多重篇章)**
     AI 會尋找自然的中斷點並建立多個篇章。
     您可以設定每個篇章的最小記憶數量。
     *最適合強大的模型 (GPT, Gemini, Sonnet)。本地模型可能會比較吃力。*
   * **Single Arc (單一篇章)**
     AI 將所有選定的記憶合併為一個篇章。
     先前的篇章也會被包含在內，以幫助保持故事連貫性。
   * **Tiny (微型)**
     一個更快、更簡單的選項，可能更適合本地模型，
     但結果可能較不詳細。
3. 選擇您想要包含的記憶。
4. 點擊 **Run (執行)** 並等待篇章分析完成。

---

## 🎨 追蹤器、旁側提示 (Side Prompts) & 範本 (進階功能)

**Side Prompts (旁側提示)** 是背景追蹤器，有助於維護進行中的故事資訊。
它們與記憶建立同時執行，並可以隨著時間更新相同的筆記。把它們想像成 **觀察您的故事並保持特定細節為最新狀態的助手**。

### 🚀 **使用範本快速開始**

1. 開啟 Memory Books 設定
2. 點擊 **Side Prompts**
3. 瀏覽 **範本庫 (template library)** 並選擇適合您故事的範本：

   * **Character Development Tracker (角色發展追蹤器)** – 追蹤個性變化與成長
   * **Relationship Dynamics (關係動態)** – 追蹤角色之間的關係
   * **Plot Thread Tracker (劇情線追蹤器)** – 追蹤進行中的故事情節
   * **Mood & Atmosphere (情緒與氛圍)** – 追蹤情感基調
   * **World Building Notes (世界觀筆記)** – 追蹤設定細節與傳說
4. 啟用您想要的範本 (稍後可以自訂)
5. 您的記憶現在將自動包含此追蹤功能

### ⚙️ **Side Prompts 如何運作**

* **背景追蹤器**：它們安靜地運行並隨時間更新資訊
* **非侵入式**：它們不會更改您的主要 AI 設定或角色提示詞
* **個別聊天控制**：不同的聊天可以使用不同的追蹤器
* **基於範本**：使用內建範本或建立您自己的範本
* **自動或手動**：有些自動執行，有些可透過指令執行

這使得觸發行為容易理解，無需使用技術術語。

### 🛠️ **管理 Side Prompts**

* **Side Prompts Manager (管理器)**：建立、編輯、複製和整理追蹤器
* **Enable / Disable (啟用/停用)**：隨時開啟或關閉追蹤器
* **Import / Export (匯入/匯出)**：分享範本或進行備份
* **Status View (狀態檢視)**：查看目前聊天中有哪些追蹤器正在運作

對於 ESL (英語非母語) 讀者來說，「狀態檢視」比「即時預覽」更清楚。

### 💡 **範本範例**

* Side Prompt 範本庫 (匯入此 JSON)：
  [SidePromptTemplateLibrary.json](/resources/SidePromptTemplateLibrary.json)

提示詞構想範例：

* 「追蹤重要的對話和角色互動」
* 「保持當前任務狀態為最新」
* 「當新的世界觀細節出現時進行記錄」
* 「追蹤角色 A 和角色 B 之間的關係」

### 🔧 **建立自訂 Side Prompts**

1. 開啟 Side Prompts Manager
2. 點擊 **Create New (建立新項目)**
3. 寫下簡短、清晰的指令
   *(例如：「總是記錄每個場景的天氣狀況」)*
4. 儲存並啟用它
5. 追蹤器現在將隨時間更新此資訊

### 💬 **專業提示**

當 Side Prompts **小而聚焦** 時效果最好。
試著不要用「追蹤所有事情」，而是嘗試「追蹤主角之間的浪漫張力」。

---

### 🧠 使用 Regex 擴充功能進行進階文字控制

**想要對發送給 AI 和從 AI 接收的文字擁有終極控制權嗎？** ST Memory Books 現在與官方 **Regex** 擴充功能無縫整合，讓您能夠使用自訂規則自動轉換文字。

**支援多重選擇：** 您現在可以在 Regex 擴充功能中多選 Regex 腳本。所有啟用的腳本將在每個階段（提示詞和回應）依序應用，實現強大且靈活的轉換。

這是一個進階功能，非常適合想要執行以下操作的使用者：
- 自動清除 AI 回應中的重複短語或瑕疵。
- 在 AI 看到聊天記錄之前重新格式化部分內容。
- 即時標準化術語或角色習慣用語。

#### **如何運作：兩個簡單的掛鉤 (Hooks)**

此整合透過在兩個關鍵點應用您啟用的 regex 腳本來運作。您可以透過在 Regex 擴充功能的編輯器中設定它們的 **Placement (位置)** 來控制執行哪些腳本：

1.  **修改提示詞 (Prompt) (發送出去的文字)**
    * **使用的位置 (Placement)**：`User Input`
    * **作用**：在組合好的提示詞（包含聊天記錄、系統指令等）發送給 AI 進行記憶或 side prompt 生成之前，攔截該提示詞。
    * **使用案例範例**：您可以建立一個腳本，自動將所有角色暱稱替換為全名，確保 AI 擁有正確的上下文。

2.  **修改回應 (Response) (傳入的文字)**
    * **使用的位置 (Placement)**：`AI Output`
    * **作用**：在 AI 的原始文字回應被解析或儲存為記憶 *之前* 攔截它。
    * **使用案例範例**：如果您的 AI 模型經常在摘要中包含重複的短語，如 *「作為一個大型語言模型...」*，您可以建立一個 regex 腳本，從它生成的每個記憶中自動刪除此短語。

#### **快速開始範例：清理 AI 回應**

假設您的 AI 模型始終在記憶生成中添加 `(OOC: I hope this summary is helpful!)`。以下是如何自動刪除它：

1.  **前往 Regex 擴充功能**：打開主要的 SillyTavern 擴充功能選單並前往 **Regex**。
2.  **建立新腳本**：點擊 "Open Regex Editor" (開啟 Regex 編輯器) 以建立新的 regex 腳本。
3.  **設定腳本**：
    * **Script Name (腳本名稱)**：`Clean OOC Notes`
    * **Find Regex (尋找 Regex)**：`/\\(OOC:.*?\\)/g` (這會尋找文字 "(OOC: ...)" 及其內部的所有內容)。
    * **Replace String (替換字串)**：保持空白以刪除匹配的文字。
    * **Affects (Placement) (影響位置)**：取消勾選所有方塊，除了 **AI Output**。這是最重要的一步！
    * **Enable the Script (啟用腳本)**：確保腳本未被停用。
4.  **儲存並完成！**

現在，每當 ST Memory Books 收到來自 AI 的回應時，此腳本就會自動執行，在記憶儲存到您的 Lorebook 之前清除不需要的文字。

---

## ⚙️ 真正重要的設定

別擔心 - 您不需要設定所有東西！以下是影響最大的設定：

### 🎛️ **Auto-Summary Frequency (自動摘要頻率)**
- **20-30 則訊息**：適合詳細、步調較慢的聊天
- **40-60 則訊息**：適合較快、充滿動作場面的對話
- **80+ 則訊息**：適用於非常快速的群組聊天或休閒對話

### 📝 **Memory Previews (記憶預覽)**
- 開啟此選項可在儲存前檢閱記憶
- 如果 AI 遺漏了重要內容，您可以編輯、批准或重新生成
- 推薦用於重要的故事線

### 🏷️ **Memory Titles (記憶標題)**
- 自訂您的記憶命名方式
- 使用 `{{title}}` 代表 AI 生成的標題，`{{scene}}` 代表訊息編號
- 範例：`"Chapter {{title}} ({{scene}})"` 會變成 `"Chapter The Great Escape (Scene 45-67)"`

### 📚 **Memory Collections (Lorebooks / 記憶集合)**
- **Auto mode (自動模式)**：使用您聊天的預設記憶集合（最簡單）
- **Manual mode (手動模式)**：為每個聊天選擇特定的集合（便於整理）
- **Auto-create (自動建立)**：自動建立新的集合（適合新角色）

---

## 🔧 疑難排解 (當功能異常時)

### 「我沒看到 Memory Books 的選項！」
- 檢查擴充功能是否已安裝並啟用
- 在您的聊天輸入框旁邊尋找魔杖圖示 (🪄)
- 嘗試重新整理頁面

### 「箭頭按鈕 (► ◄) 沒有出現！」
- 載入聊天後等待 3-5 秒 - 它們需要時間出現
- 如果仍然遺失，請重新整理頁面
- 確保 ST Memory Books 已在擴充功能中啟用

### 「自動摘要 (Auto Summary) 沒有運作！」
- 仔細檢查 Memory Books 設定中的 "Auto-Summary" 是否已啟用
- 是否已達到訊息間隔？自動摘要會等待足夠的新訊息
- 如果您延後了自動摘要，它可能會等待直到達到特定的訊息數量
- 自動摘要僅處理自 *上一次* 記憶以來的 *新* 訊息。如果您刪除了舊記憶，它不會回頭處理。

### 「我收到關於遺失 Lorebook 的錯誤！」
- 前往 Memory Books 設定
- 將 Lorebook 綁定到您的聊天 (Automatic Mode)，或啟用 "Auto-create lorebook if none exists" (若無則自動建立 Lorebook)

### 「有時候它會無故失敗！」
- 確保您的 Max Response Length (在 SillyTavern 預設值中) 設定為夠大的數字。Aiko 建議至少 2000 token (Aiko 使用 4000)。
- 錯誤訊息現在更加詳細，但如果您仍有問題，請在 Github 或 Discord 上聯繫 Aiko。

### 「我的自訂提示詞 (prompts) 運作不正常！」
- 檢查 Memory Books 設定中的 "Summary Prompt Manager"
- 確保您的提示詞指示 AI 以 **JSON 格式** 回應 (例如：`{ "title": "...", "content": "..." }`)

---

## 🚫 ST Memory Books「不會」做什麼

- **不是通用的 Lorebook 編輯器：** 本指南專注於 STMB 建立的條目。若要進行一般的 Lorebook 編輯，請使用 SillyTavern 內建的 Lorebook 編輯器。

---

## 💡 取得協助與更多資訊

- **更詳細的資訊：** [readme.md](readme.md)
- **最新更新：** [changelog.md](changelog.md)
- **轉換舊的 Lorebook：** [lorebookconverter.html](lorebookconverter.html)
- **社群支援：** 加入 Discord 上的 SillyTavern 社群！(尋找 📕ST Memory Books 討論串或私訊 @tokyoapple 尋求直接協助。)
- **錯誤/功能：** 發現錯誤或有好點子？在此儲存庫開啟 GitHub issue。

---

### 📚 透過 Lorebook Ordering (STLO) 增強功能

為了獲得進階的記憶整理和更深度的故事整合，我們強烈建議將 STMB 與 [SillyTavern-LorebookOrdering (STLO)](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering/blob/main/guides/STMB%20and%20STLO%20-%20English.md) 一起使用。請參閱指南以了解最佳實踐、設定說明和技巧！